ALTER TABLE DBCH_DBCHANGE ADD REGISTERED_AT timestamp NOT NULL;
ALTER TABLE DBCH_DBCHANGE ADD IS_ACTIVE number(1) DEFAULT 1 NOT NULL;
ALTER TABLE DBCH_DBCHANGE ADD VERSION_NUMBER number DEFAULT 1 NOT NULL;

ALTER TABLE DBCH_DBCHANGE ADD CONSTRAINT CODE_VERSION_NUMBER_U UNIQUE (CODE, VERSION_NUMBER);
-- DROP UNIQUE DBCH_DBCHANGE.CODE

CREATE OR REPLACE TRIGGER "DBCH_DB_registered_at"
BEFORE INSERT ON DBCH_DBCHANGE
FOR EACH ROW
WHEN (new.REGISTERED_AT IS NULL)
  BEGIN
    SELECT SYSDATE INTO :new.REGISTERED_AT FROM dual;
  END;
/
